import{_ as A}from"../../../chunks/preload-helper-c28b9807.js";import{S as le,i as ce,P as g,s as fe,w as F,x as j,y as M,K as Z,f as W,t as b,B as R,Y as L,N as de,l as D,a as H,m as E,n as N,c as J,h as v,Q as me,p as w,b as $,J as k,g as _e,d as ue,W as U}from"../../../chunks/index-70a5fc52.js";import{W as pe}from"../../../chunks/Window-654de68f.js";import{z as we,h as he,a as V,r as ge}from"../../../chunks/store-59feb90e.js";import{j as Q}from"../../../chunks/utils-1f7a3290.js";import{M as ye}from"../../../chunks/Menu-84d20aec.js";import{d as Y,j as xe,s as We,e as ve}from"../../../chunks/fs-f48425c2.js";import{D as be}from"../../../chunks/DumbProgress-0b7ff768.js";import"../../../chunks/TitleBar-5f961d1e.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-355ed6be.js";import"../../../chunks/index-f053a494.js";import"../../../chunks/finder-52261c48.js";import"../../../chunks/ProgressBar-f6d33f67.js";const{window:ke}=de;function G(r){let e,o,f;return o=new be({props:{style:"width:150px;height:15px;"}}),{c(){e=D("div"),F(o.$$.fragment),this.h()},l(s){e=E(s,"DIV",{class:!0});var d=N(e);j(o.$$.fragment,d),d.forEach(v),this.h()},h(){w(e,"class","absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 text-slate-500 text-sm p-2 rounded font-mono")},m(s,d){$(s,e,d),M(o,e,null),f=!0},i(s){f||(W(o.$$.fragment,s),f=!0)},o(s){b(o.$$.fragment,s),f=!1},d(s){s&&v(e),R(o)}}}function De(r){let e,o,f,s,d,n,l,_,a,h,i;o=new ye({props:{menu:r[5]}});let c=!r[4]&&G();return{c(){e=D("div"),F(o.$$.fragment),f=H(),s=D("div"),c&&c.c(),d=H(),n=D("iframe"),this.h()},l(m){e=E(m,"DIV",{slot:!0,class:!0});var u=N(e);j(o.$$.fragment,u),f=J(u),s=E(u,"DIV",{class:!0});var y=N(s);c&&c.l(y),d=J(y),n=E(y,"IFRAME",{src:!0,class:!0,frameborder:!0}),N(n).forEach(v),y.forEach(v),u.forEach(v),this.h()},h(){me(n.src,l="/html/notepad/index.html")||w(n,"src",l),w(n,"class",_="w-full h-full "+(r[4]?"":"opacity-0")),w(n,"frameborder","0"),w(s,"class","absolute inset-0 top-[25px] overflow-auto bg-slate-50 font-sans"),w(e,"slot","content"),w(e,"class","absolute inset-1 top-0 flex flex-col bg-xp-yellow")},m(m,u){$(m,e,u),M(o,e,null),k(e,f),k(e,s),c&&c.m(s,null),k(s,d),k(s,n),r[15](n),a=!0,h||(i=Z(n,"load",r[6]),h=!0)},p(m,u){m[4]?c&&(_e(),b(c,1,1,()=>{c=null}),ue()):c?u&16&&W(c,1):(c=G(),c.c(),W(c,1),c.m(s,d)),(!a||u&16&&_!==(_="w-full h-full "+(m[4]?"":"opacity-0")))&&w(n,"class",_)},i(m){a||(W(o.$$.fragment,m),W(c),a=!0)},o(m){b(o.$$.fragment,m),b(c),a=!1},d(m){m&&v(e),R(o),c&&c.d(),r[15](null),h=!1,i()}}}function Ee(r){let e,o,f,s,d={options:r[1],on_click_close:r[2],on_focused:r[8],$$slots:{content:[De]},$$scope:{ctx:r}};return e=new pe({props:d}),r[16](e),{c(){F(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,l){M(e,n,l),o=!0,f||(s=Z(ke,"keydown",r[7]),f=!0)},p(n,[l]){const _={};l&2&&(_.options=n[1]),l&33554456&&(_.$$scope={dirty:l,ctx:n}),e.$set(_)},i(n){o||(W(e.$$.fragment,n),o=!0)},o(n){b(e.$$.fragment,n),o=!1},d(n){r[16](null),R(e,n),f=!1,s()}}}let X="Notepad";async function Ne({node_ref:r,filetypes_desc:e,filetypes:o}){return new Promise(async(f,s)=>{const d=(await A(()=>import("../../../chunks/OpenModal-56629948.js"),["_app/immutable/chunks/OpenModal-56629948.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-70a5fc52.js","_app/immutable/chunks/TitleBar-5f961d1e.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-59feb90e.js","_app/immutable/chunks/index-f053a494.js","_app/immutable/chunks/finder-52261c48.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/fs-f48425c2.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-e8580b92.js","_app/immutable/chunks/Previewable-7057b01c.js"])).default;let n=new d({target:r,props:{filetypes:o,filetypes_desc:e}});n.self=n,n.on_open=()=>{f(n.selected_items),n.destroy()}})}async function Pe({node_ref:r,filetypes:e,id:o,current_filetype:f}){return new Promise(async(s,d)=>{const n=(await A(()=>import("../../../chunks/SaveModal-25d78340.js"),["_app/immutable/chunks/SaveModal-25d78340.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-70a5fc52.js","_app/immutable/chunks/TitleBar-5f961d1e.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-59feb90e.js","_app/immutable/chunks/index-f053a494.js","_app/immutable/chunks/finder-52261c48.js","_app/immutable/chunks/fs-f48425c2.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-e8580b92.js","_app/immutable/chunks/Previewable-7057b01c.js"])).default;let l=new n({target:r,props:{filetypes:e,selected_filetype:f,id:o}});l.self=l,l.on_save=()=>{s({parent_id:l.parent_id,filename:l.filename,selected_filetype:l.selected_filetype}),l.destroy()}})}async function Se({node_ref:r,title:e,message:o,icon:f,yes_action:s,no_action:d}){const n=(await A(()=>import("../../../chunks/Dialog-b1bab363.js"),["_app/immutable/chunks/Dialog-b1bab363.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-70a5fc52.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/TitleBar-5f961d1e.js","_app/immutable/chunks/Button-e8580b92.js"])).default;let l=[{name:"Save",action:()=>{s(),_.destroy()},focus:!0},{name:"Don't Save",action:()=>{d(),_.destroy()}},{name:"Cancel",action:()=>{_.destroy()}}],_=new n({target:r,props:{icon:f,title:e,message:o,buttons:l,button_align:"center"}});_.self=_}function Ie(r,e,o){let f,s;L(r,we,t=>o(17,f=t)),L(r,he,t=>o(18,s=t));let{id:d}=e,{window:n}=e,{self:l}=e,{parentNode:_}=e,{fs_item:a}=e,{exec_path:h}=e,i,c=!1,m=!1,{options:u={title:X,min_width:300,min_height:200,width:600,height:500,icon:"/images/xp/icons/Notepad.png",id:d,exec_path:h}}=e,y=[{name:"File",items:[[{name:"Open",action:O}],[{name:"Save",action:I},{name:"Save As",action:C}],[{name:"Exit",action:z}]]},{name:"Edit",items:[[{name:"Undo",action:()=>i.contentWindow.undo()},{name:"Redo",action:()=>i.contentWindow.redo()}],[{name:"Find",action:()=>i.contentWindow.find()},{name:"Replace",action:()=>i.contentWindow.replace()}],[{name:"Date/Time",action:()=>i.contentWindow.insert(new Date().toDateString())}]]},{name:"Format",items:[[{name:"Word Wrap",action:()=>i.contentWindow.toggle_wrap()}]]},{name:"View",items:[[{name:"Status Bar"}]]},{name:"Help",items:[[{name:"Help Topics",action:()=>{V.set({path:"./programs/internet_explorer.svelte",fs_item:{url:"https://en.wikipedia.org/wiki/Windows_Notepad"}})}},{name:"About Notepad",action:()=>{V.set({path:"./programs/internet_explorer.svelte",fs_item:{url:"https://en.wikipedia.org/wiki/Windows_Notepad"}})}}]]}],P=[{name:"Plain Text (.txt)",ext:".txt"},{name:"Web Page (.html)",ext:".html"},{name:"Markdown (.md)",ext:".md"},{name:"Javascript (.js)",ext:".js"},{name:"VBScript (.vbs)",ext:".vbs"}];async function O(){let t=await ee({filetypes_desc:"All Files",filetypes:[]});if(a||m)V.set({path:"./programs/notepad.svelte",fs_item:t});else{o(9,a=t);let x=await(await Y(a.id)).text();i.contentWindow.set_content(x),i.contentWindow.set_mode(a.name)}}async function z(){if(m){let t=()=>{S()},p=async()=>{await I(),S()};Se({node_ref:n.node_ref,title:"Save Changes",message:"Do you want to save the changes you've made before closing this document?",yes_action:p,no_action:t})}else S()}function S(){ge.update(t=>t.filter(p=>p!=l)),l.$destroy()}async function ee({filetypes_desc:t,filetypes:p}){let x=await Ne({node_ref:n.node_ref,filetypes_desc:t,filetypes:p});return s[x[0]]}async function I(){if(a!=null){let t=i.contentWindow.get_content(),p=new File([t],a.name,{type:Q(a.ext)});xe(a.id,p),i.contentWindow.set_mode(a.name),n.show_toast({message:"Changes Saved!",theme:"light"})}else await C();i.contentWindow.set_clean(),o(14,m=!1)}async function C(){console.log(a);let t=P.find(re=>re.ext==(a==null?void 0:a.ext));t==null&&(t=P[0]);let{parent_id:p,filename:x,selected_filetype:T}=await Pe({id:a==null?void 0:a.parent,node_ref:n.node_ref,filetypes:P,current_filetype:t}),se=Q(T.ext),ae=i.contentWindow.get_content(),B=new File([ae],x,{type:se});console.log(B);let K=We.generate();await ve(x,T.ext,B,p,K),a==null&&o(9,a=s[K])}async function te(){if(console.log(i),a){let p=await(await Y(a.id)).text();i.contentWindow.set_content(p),i.contentWindow.set_mode(a.name)}else i.contentWindow.set_content("");o(3,i.contentWindow.dirty_state_changed=()=>{o(14,m=i.contentWindow.is_dirty()),console.log({dirty:m})},i),o(3,i.contentWindow.editor_clicked=()=>{n.focus()},i),o(3,i.contentWindow.parent_key_event=q,i),o(4,c=!0),setTimeout(()=>{i.contentWindow.editor.focus()},500)}function q(t){n.z_index==f&&(!(t.ctrlKey||t.metaKey)||(console.log("keyevent receive in notepad"),t.key=="s"?(t.preventDefault(),I()):t.key=="o"&&(t.preventDefault(),O())))}function ne(){setTimeout(()=>{i&&i.contentWindow.editor.focus()},500)}function oe(t){U[t?"unshift":"push"](()=>{i=t,o(3,i)})}function ie(t){U[t?"unshift":"push"](()=>{n=t,o(0,n)})}return r.$$set=t=>{"id"in t&&o(10,d=t.id),"window"in t&&o(0,n=t.window),"self"in t&&o(11,l=t.self),"parentNode"in t&&o(12,_=t.parentNode),"fs_item"in t&&o(9,a=t.fs_item),"exec_path"in t&&o(13,h=t.exec_path),"options"in t&&o(1,u=t.options)},r.$$.update=()=>{if(r.$$.dirty&16897){let t="";a?t=a.name:t=X,m&&(t+=" *"),n&&n.update_title(t)}},[n,u,z,i,c,y,te,q,ne,a,d,l,_,h,m,oe,ie]}class Je extends le{constructor(e){super(),ce(this,e,Ie,Ee,fe,{id:10,window:0,self:11,parentNode:12,fs_item:9,exec_path:13,options:1,destroy:2})}get id(){return this.$$.ctx[10]}set id(e){this.$$set({id:e}),g()}get window(){return this.$$.ctx[0]}set window(e){this.$$set({window:e}),g()}get self(){return this.$$.ctx[11]}set self(e){this.$$set({self:e}),g()}get parentNode(){return this.$$.ctx[12]}set parentNode(e){this.$$set({parentNode:e}),g()}get fs_item(){return this.$$.ctx[9]}set fs_item(e){this.$$set({fs_item:e}),g()}get exec_path(){return this.$$.ctx[13]}set exec_path(e){this.$$set({exec_path:e}),g()}get options(){return this.$$.ctx[1]}set options(e){this.$$set({options:e}),g()}get destroy(){return this.$$.ctx[2]}}export{Je as default};
