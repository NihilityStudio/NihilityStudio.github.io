import{_ as M}from"../../../chunks/preload-helper-c28b9807.js";import{S as Z,i as G,R as m,s as Q,w as N,x as S,y as V,f as g,t as x,B as q,Z as E,l as D,a as X,m as v,n as k,c as $,h as y,T as ee,p as u,b as j,J as I,K as te,g as ne,d as ie,Y as R}from"../../../chunks/index-23b4510f.js";import{W as se}from"../../../chunks/Window-5b3973f4.js";import{h as oe,z as ae,r as re}from"../../../chunks/store-21632576.js";import{j as le}from"../../../chunks/utils-1f7a3290.js";import{d as z,f as fe,s as ce}from"../../../chunks/fs-93cd4a3b.js";import{s as _e}from"../../../chunks/index-5b24d155.js";import{D as de}from"../../../chunks/DumbProgress-04334b73.js";import"../../../chunks/TitleBar-a60117f4.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-355ed6be.js";import"../../../chunks/index-6533b345.js";import"../../../chunks/finder-bfb6260e.js";function A(r){let e,n,o;return n=new de({props:{style:"width:150px;height:15px;"}}),{c(){e=D("div"),N(n.$$.fragment),this.h()},l(s){e=v(s,"DIV",{class:!0});var l=k(e);S(n.$$.fragment,l),l.forEach(y),this.h()},h(){u(e,"class","absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 text-slate-500 text-sm p-2 rounded font-mono")},m(s,l){j(s,e,l),V(n,e,null),o=!0},i(s){o||(g(n.$$.fragment,s),o=!0)},o(s){x(n.$$.fragment,s),o=!1},d(s){s&&y(e),q(n)}}}function ue(r){let e,n,o,s,l,a,_,p,i=!r[4]&&A();return{c(){e=D("div"),i&&i.c(),n=X(),o=D("iframe"),this.h()},l(f){e=v(f,"DIV",{slot:!0,class:!0});var d=k(e);i&&i.l(d),n=$(d),o=v(d,"IFRAME",{src:!0,width:!0,height:!0,class:!0});var c=k(o);c.forEach(y),d.forEach(y),this.h()},h(){var f;ee(o.src,s="/html/foxit_reader/web/viewer.html")||u(o,"src",s),u(o,"width","100%"),u(o,"height","100%"),u(o,"class",l="inset-0 absolute bg-black "+(r[4]?"":"opacity-0")+" "+(((f=r[0])==null?void 0:f.z_index)==r[5]?"pointer-events-auto":"pointer-events-none")),u(e,"slot","content"),u(e,"class","absolute inset-1 top-0 flex flex-col bg-slate-50")},m(f,d){j(f,e,d),i&&i.m(e,null),I(e,n),I(e,o),r[12](o),a=!0,_||(p=te(o,"load",r[6]),_=!0)},p(f,d){var c;f[4]?i&&(ne(),x(i,1,1,()=>{i=null}),ie()):i?d&16&&g(i,1):(i=A(),i.c(),g(i,1),i.m(e,n)),(!a||d&49&&l!==(l="inset-0 absolute bg-black "+(f[4]?"":"opacity-0")+" "+(((c=f[0])==null?void 0:c.z_index)==f[5]?"pointer-events-auto":"pointer-events-none")))&&u(o,"class",l)},i(f){a||(g(i),a=!0)},o(f){x(i),a=!1},d(f){f&&y(e),i&&i.d(),r[12](null),_=!1,p()}}}function me(r){let e,n,o={options:r[2],on_click_close:r[1],$$slots:{content:[ue]},$$scope:{ctx:r}};return e=new se({props:o}),r[13](e),{c(){N(e.$$.fragment)},l(s){S(e.$$.fragment,s)},m(s,l){V(e,s,l),n=!0},p(s,[l]){const a={};l&4&&(a.options=s[2]),l&524345&&(a.$$scope={dirty:l,ctx:s}),e.$set(a)},i(s){n||(g(e.$$.fragment,s),n=!0)},o(s){x(e.$$.fragment,s),n=!1},d(s){r[13](null),q(e,s)}}}async function pe({node_ref:r,filetypes_desc:e,filetypes:n}){return new Promise(async(o,s)=>{const l=(await M(()=>import("../../../chunks/OpenModal-db8f6c19.js"),["_app/immutable/chunks/OpenModal-db8f6c19.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-23b4510f.js","_app/immutable/chunks/TitleBar-a60117f4.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-21632576.js","_app/immutable/chunks/index-6533b345.js","_app/immutable/chunks/finder-bfb6260e.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-5b24d155.js","_app/immutable/chunks/fs-93cd4a3b.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-b8e82496.js","_app/immutable/chunks/Previewable-2a157018.js"])).default;let a=new l({target:r,props:{filetypes:n,filetypes_desc:e}});a.self=a,a.on_open=()=>{o(a.selected_items),a.destroy()}})}async function he({node_ref:r,filetypes:e,id:n,current_filetype:o}){return new Promise(async(s,l)=>{const a=(await M(()=>import("../../../chunks/SaveModal-a41fe8c5.js"),["_app/immutable/chunks/SaveModal-a41fe8c5.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-23b4510f.js","_app/immutable/chunks/TitleBar-a60117f4.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-21632576.js","_app/immutable/chunks/index-6533b345.js","_app/immutable/chunks/finder-bfb6260e.js","_app/immutable/chunks/index-5b24d155.js","_app/immutable/chunks/fs-93cd4a3b.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-b8e82496.js","_app/immutable/chunks/Previewable-2a157018.js"])).default;let _=new a({target:r,props:{filetypes:e,selected_filetype:o,id:n}});_.self=_,_.on_save=()=>{s({parent_id:_.parent_id,filename:_.filename,selected_filetype:_.selected_filetype}),_.destroy()}})}function we(r,e,n){let o,s;E(r,oe,t=>n(15,o=t)),E(r,ae,t=>n(5,s=t));let{id:l}=e,{window:a}=e,{self:_}=e,{parentNode:p}=e,{fs_item:i}=e,{exec_path:f}=e,d=[{name:"Adobe Portable Document Format",mime:"application/pdf",ext:".pdf"}];d=d.map(t=>(t.name=t.name+" ("+t.ext+")",t));let c,P=!1;async function O(){re.update(t=>t.filter(h=>h!=_)),_.$destroy()}let b={width:document.querySelector("#work-space").offsetWidth,height:document.querySelector("#work-space").offsetHeight},{options:W={title:i==null?"Foxit Reader":i.name,min_width:500,min_height:400,width:Math.min(b.width-20,(b.height-20)*1.6),height:Math.min(b.height-20),icon:"/images/xp/icons/FoxitReader.png",id:l,exec_path:f}}=e;async function T(){let t=await pe({node_ref:a.node_ref,filetypes_desc:"Adobe Portable Document Format",filetypes:d.map(w=>w.ext)});n(7,i=o[t[0]]);let h=await z(t[0]);return console.log({fs_item:i}),h}async function L(){console.log(i);let t=d.find(Y=>Y.ext==(i==null?void 0:i.ext));t==null&&(t=d[0]);let{parent_id:h,filename:w,selected_filetype:J}=await he({id:i==null?void 0:i.parent,node_ref:a.node_ref,filetypes:d,current_filetype:t}),K=await c.contentWindow.PDFViewerApplication.pdfDocument.saveDocument(),U=new File([K],w,{type:le(w)}),F=_e.generate();await ce(w,J.ext,U,h,F),n(7,i=o[F])}async function B(){if(c.contentWindow.setup_ui(),i!=null){let t=await z(i.id);c.contentWindow.open(t)}else{let t=await fe("/files/FoxitReader30_Manual.pdf");c.contentWindow.open(t)}n(3,c.contentWindow.open_file_func=async()=>{let t=await T();c.contentWindow.open(t)},c),n(3,c.contentWindow.save_file_as_func=async()=>{await L()},c),n(4,P=!0)}function C(t){R[t?"unshift":"push"](()=>{c=t,n(3,c)})}function H(t){R[t?"unshift":"push"](()=>{a=t,n(0,a)})}return r.$$set=t=>{"id"in t&&n(8,l=t.id),"window"in t&&n(0,a=t.window),"self"in t&&n(9,_=t.self),"parentNode"in t&&n(10,p=t.parentNode),"fs_item"in t&&n(7,i=t.fs_item),"exec_path"in t&&n(11,f=t.exec_path),"options"in t&&n(2,W=t.options)},r.$$.update=()=>{r.$$.dirty&129&&i&&a&&a.update_title(i.name)},[a,O,W,c,P,s,B,i,l,_,p,f,C,H]}class Ae extends Z{constructor(e){super(),G(this,e,we,me,Q,{id:8,window:0,self:9,parentNode:10,fs_item:7,exec_path:11,destroy:1,options:2})}get id(){return this.$$.ctx[8]}set id(e){this.$$set({id:e}),m()}get window(){return this.$$.ctx[0]}set window(e){this.$$set({window:e}),m()}get self(){return this.$$.ctx[9]}set self(e){this.$$set({self:e}),m()}get parentNode(){return this.$$.ctx[10]}set parentNode(e){this.$$set({parentNode:e}),m()}get fs_item(){return this.$$.ctx[7]}set fs_item(e){this.$$set({fs_item:e}),m()}get exec_path(){return this.$$.ctx[11]}set exec_path(e){this.$$set({exec_path:e}),m()}get destroy(){return this.$$.ctx[1]}get options(){return this.$$.ctx[2]}set options(e){this.$$set({options:e}),m()}}export{Ae as default};
