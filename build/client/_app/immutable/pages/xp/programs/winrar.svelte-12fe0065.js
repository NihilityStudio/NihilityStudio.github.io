import{S as ee,i as te,s as se,l as E,w as C,m as k,n as P,x as M,h as b,p as w,b as U,y as O,f as x,t as $,B as A,o as ne,Y as re,R as D,a as T,c as I,J as g,g as W,d as K,r as L,u as j,T as ae,v as ie,a9 as q,K as G,N as oe}from"../../../chunks/index-23b4510f.js";import{W as ce}from"../../../chunks/Window-5b3973f4.js";import{B as H}from"../../../chunks/Button-b8e82496.js";import{r as fe}from"../../../chunks/store-21632576.js";import{b as ue,j as pe,h as he,g as X}from"../../../chunks/utils-1f7a3290.js";import{d as J,b as Q}from"../../../chunks/fs-93cd4a3b.js";import{P as _e}from"../../../chunks/ProgressBar-05ab9478.js";import"../../../chunks/TitleBar-a60117f4.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-355ed6be.js";/* empty css                                                           */import"../../../chunks/index-6533b345.js";import"../../../chunks/index-5b24d155.js";import"../../../chunks/finder-bfb6260e.js";function de(f){let e,t,n,s={value:10,style:"width:100%;height:100%;"};return t=new _e({props:s}),f[3](t),{c(){e=E("div"),C(t.$$.fragment),this.h()},l(r){e=k(r,"DIV",{style:!0});var l=P(e);M(t.$$.fragment,l),l.forEach(b),this.h()},h(){w(e,"style",f[0])},m(r,l){U(r,e,l),O(t,e,null),n=!0},p(r,[l]){const a={};t.$set(a),(!n||l&1)&&w(e,"style",r[0])},i(r){n||(x(t.$$.fragment,r),n=!0)},o(r){$(t.$$.fragment,r),n=!1},d(r){r&&b(e),f[3](null),A(t)}}}function me(f,e,t){let{style:n=""}=e,{increment:s=5}=e,r;ne(async()=>{for(;r!=null;)t(1,r.value=Math.min(r.value+s,100),r),r.value>=100&&t(1,r.value=0,r),await ue(500)});function l(a){re[a?"unshift":"push"](()=>{r=a,t(1,r)})}return f.$$set=a=>{"style"in a&&t(0,n=a.style),"increment"in a&&t(2,s=a.increment)},[n,r,s,l]}class ge extends ee{constructor(e){super(),te(this,e,me,de,se,{style:0,increment:2})}}class B{constructor(e,t,n,s){this._name=e,this._size=t,this._path=n,this._archiveRef=s}get name(){return this._name}get size(){return this._size}extract(){return this._archiveRef.extractSingleFile(this._path)}}class N{static init(e={}){return N._options={workerUrl:"../dist/worker-bundle.js",...e},N._options}static open(e,t=null){return t=t||N._options||N.init()&&console.warn("Automatically initializing using options: ",N._options),new N(e,t).open()}constructor(e,t){this._worker=new Worker(t.workerUrl),this._worker.addEventListener("message",this._workerMsg.bind(this)),this._callbacks=[],this._content={},this._processed=0,this._file=e}async open(){return await this._postMessage({type:"HELLO"},(e,t,n)=>{n.type==="READY"&&e()}),await this._postMessage({type:"OPEN",file:this._file},(e,t,n)=>{n.type==="OPENED"&&e(this)})}hasEncryptedData(){return this._postMessage({type:"CHECK_ENCRYPTION"},(e,t,n)=>{n.type==="ENCRYPTION_STATUS"&&e(n.status)})}usePassword(e){return this._postMessage({type:"SET_PASSPHRASE",passphrase:e},(t,n,s)=>{s.type==="PASSPHRASE_STATUS"&&t(s.status)})}getFilesObject(){return this._processed>0?Promise.resolve().then(()=>this._content):this._postMessage({type:"LIST_FILES"},(e,t,n)=>{if(n.type==="ENTRY"){const s=n.entry,[r,l]=this._getProp(this._content,s.path);return s.type==="FILE"&&(r[l]=new B(s.fileName,s.size,s.path,this)),!0}else n.type==="END"&&(this._processed=1,e(this._cloneContent(this._content)))})}getFilesArray(){return this.getFilesObject().then(e=>this._objectToArray(e))}extractSingleFile(e){return this._postMessage({type:"EXTRACT_SINGLE_FILE",target:e},(t,n,s)=>{if(s.type==="FILE"){const r=new File([s.entry.fileData],s.entry.fileName,{type:"application/octet-stream"});t(r)}})}extractFiles(e){return this._processed>1?Promise.resolve().then(()=>this._content):this._postMessage({type:"EXTRACT_FILES"},(t,n,s)=>{if(s.type==="ENTRY"){const[r,l]=this._getProp(this._content,s.entry.path);return s.entry.type==="FILE"&&(r[l]=new File([s.entry.fileData],s.entry.fileName,{type:"application/octet-stream"}),e!==void 0&&setTimeout(e.bind(null,{file:r[l],path:s.entry.path}))),!0}else s.type==="END"&&(this._processed=2,this._worker.terminate(),t(this._cloneContent(this._content)))})}_cloneContent(e){if(e instanceof File||e instanceof B||e===null)return e;const t={};for(const n of Object.keys(e))t[n]=this._cloneContent(e[n]);return t}_objectToArray(e,t=""){const n=[];for(const s of Object.keys(e))e[s]instanceof File||e[s]instanceof B||e[s]===null?n.push({file:e[s]||s,path:t}):n.push(...this._objectToArray(e[s],`${t}${s}/`));return n}_getProp(e,t){const n=t.split("/");n[n.length-1]===""&&n.pop();let s=e,r=null;for(const l of n)s[l]=s[l]||{},r=s,s=s[l];return[r,n[n.length-1]]}_postMessage(e,t){return this._worker.postMessage(e),new Promise((n,s)=>{this._callbacks.push(this._msgHandler.bind(this,t,n,s))})}_msgHandler(e,t,n,s){if(s.type==="BUSY")n("worker is busy");else if(s.type==="ERROR")n(s.error);else return e(t,n,s)}_workerMsg({data:e}){const t=this._callbacks[this._callbacks.length-1];t(e)||this._callbacks.pop()}}function we(f){let e,t,n,s,r,l,a,_,o,i,u,p,m;return _=new H({props:{title:"OK",on_click:f[7]}}),i=new H({props:{title:"Cancel",on_click:f[3]}}),{c(){e=E("div"),t=E("p"),n=L("Enter password:"),s=T(),r=E("input"),l=T(),a=E("div"),C(_.$$.fragment),o=T(),C(i.$$.fragment),this.h()},l(h){e=k(h,"DIV",{class:!0});var d=P(e);t=k(d,"P",{class:!0});var y=P(t);n=j(y,"Enter password:"),y.forEach(b),s=I(d),r=k(d,"INPUT",{type:!0,class:!0}),l=I(d),a=k(d,"DIV",{class:!0});var v=P(a);M(_.$$.fragment,v),o=I(v),M(i.$$.fragment,v),v.forEach(b),d.forEach(b),this.h()},h(){w(t,"class","my-2 text-[13px]"),r.autofocus=!0,w(r,"type","password"),w(r,"class","outline-none border border-slate-800 text-[11px] p-1"),w(a,"class","flex flex-row h-7 justify-evenly"),w(e,"class","absolute inset-4 flex flex-col overflow-hidden justify-between")},m(h,d){U(h,e,d),g(e,t),g(t,n),g(e,s),g(e,r),q(r,f[6]),g(e,l),g(e,a),O(_,a,null),g(a,o),O(i,a,null),u=!0,r.focus(),p||(m=[G(r,"input",f[12]),G(r,"keydown",f[13])],p=!0)},p(h,d){d&64&&r.value!==h[6]&&q(r,h[6])},i(h){u||(x(_.$$.fragment,h),x(i.$$.fragment,h),u=!0)},o(h){$(_.$$.fragment,h),$(i.$$.fragment,h),u=!1},d(h){h&&b(e),A(_),A(i),p=!1,oe(m)}}}function ye(f){let e,t,n,s=(f[1]?f[1].name:"")+"",r,l,a,_,o,i,u;return _=new ge({props:{style:"height:15px;margin:5px 0;flex-shrink:0;"}}),i=new H({props:{title:"Cancel",on_click:f[3]}}),{c(){e=E("div"),t=E("p"),n=L("Extracting "),r=L(s),l=L("..."),a=T(),C(_.$$.fragment),o=T(),C(i.$$.fragment),this.h()},l(p){e=k(p,"DIV",{class:!0});var m=P(e);t=k(m,"P",{class:!0});var h=P(t);n=j(h,"Extracting "),r=j(h,s),l=j(h,"..."),h.forEach(b),a=I(m),M(_.$$.fragment,m),o=I(m),M(i.$$.fragment,m),m.forEach(b),this.h()},h(){w(t,"class","my-2 text-[13px] text-ellipsis line-clamp-3"),w(e,"class","absolute inset-4 flex flex-col overflow-hidden justify-between")},m(p,m){U(p,e,m),g(e,t),g(t,n),g(t,r),g(t,l),g(e,a),O(_,e,null),g(e,o),O(i,e,null),u=!0},p(p,m){(!u||m&2)&&s!==(s=(p[1]?p[1].name:"")+"")&&ie(r,s)},i(p){u||(x(_.$$.fragment,p),x(i.$$.fragment,p),u=!0)},o(p){$(_.$$.fragment,p),$(i.$$.fragment,p),u=!1},d(p){p&&b(e),A(_),A(i)}}}function Z(f){let e,t,n,s,r,l,a,_,o,i=f[4].message+"",u,p,m,h;return m=new H({props:{title:"OK",on_click:f[3]}}),{c(){e=E("div"),t=E("div"),n=E("img"),r=T(),l=E("p"),a=L("Error"),_=T(),o=E("p"),u=L(i),p=T(),C(m.$$.fragment),this.h()},l(d){e=k(d,"DIV",{class:!0});var y=P(e);t=k(y,"DIV",{class:!0});var v=P(t);n=k(v,"IMG",{src:!0,class:!0,alt:!0}),r=I(v),l=k(v,"P",{class:!0});var V=P(l);a=j(V,"Error"),V.forEach(b),v.forEach(b),_=I(y),o=k(y,"P",{class:!0});var Y=P(o);u=j(Y,i),Y.forEach(b),p=I(y),M(m.$$.fragment,y),y.forEach(b),this.h()},h(){ae(n.src,s="/images/xp/icons/Critical.png")||w(n,"src",s),w(n,"class","w-8 h-8 mr-1"),w(n,"alt",""),w(l,"class","font-bold text-[13px]"),w(t,"class","flex flex-row mt-2 items-center"),w(o,"class","mb-2 text-[13px] text-ellipsis line-clamp-3"),w(e,"class","absolute inset-4 bg-xp-yellow flex flex-col justify-between overflow-hidden")},m(d,y){U(d,e,y),g(e,t),g(t,n),g(t,r),g(t,l),g(l,a),g(e,_),g(e,o),g(o,u),g(e,p),O(m,e,null),h=!0},p(d,y){(!h||y&16)&&i!==(i=d[4].message+"")&&ie(u,i)},i(d){h||(x(m.$$.fragment,d),h=!0)},o(d){$(m.$$.fragment,d),h=!1},d(d){d&&b(e),A(m)}}}function be(f){let e,t,n,s,r;const l=[ye,we],a=[];function _(i,u){return i[5]?1:0}t=_(f),n=a[t]=l[t](f);let o=f[4]&&Z(f);return{c(){e=E("div"),n.c(),s=T(),o&&o.c(),this.h()},l(i){e=k(i,"DIV",{slot:!0,class:!0});var u=P(e);n.l(u),s=I(u),o&&o.l(u),u.forEach(b),this.h()},h(){w(e,"slot","content"),w(e,"class","absolute inset-1 top-0 bg-xp-yellow")},m(i,u){U(i,e,u),a[t].m(e,null),g(e,s),o&&o.m(e,null),r=!0},p(i,u){let p=t;t=_(i),t===p?a[t].p(i,u):(W(),$(a[p],1,1,()=>{a[p]=null}),K(),n=a[t],n?n.p(i,u):(n=a[t]=l[t](i),n.c()),x(n,1),n.m(e,s)),i[4]?o?(o.p(i,u),u&16&&x(o,1)):(o=Z(i),o.c(),x(o,1),o.m(e,null)):o&&(W(),$(o,1,1,()=>{o=null}),K())},i(i){r||(x(n),x(o),r=!0)},o(i){$(n),$(o),r=!1},d(i){i&&b(e),a[t].d(),o&&o.d()}}}function Ee(f){let e,t,n={options:f[2],on_click_close:f[3],$$slots:{content:[be]},$$scope:{ctx:f}};return e=new ce({props:n}),f[14](e),{c(){C(e.$$.fragment)},l(s){M(e.$$.fragment,s)},m(s,r){O(e,s,r),t=!0},p(s,[r]){const l={};r&4&&(l.options=s[2]),r&262258&&(l.$$scope={dirty:r,ctx:s}),e.$set(l)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){f[14](null),A(e,s)}}}function ke(f,e,t){let{id:n}=e,{window:s}=e,{self:r}=e,{parentNode:l}=e,{fs_item:a}=e,{exec_path:_}=e,o,i=!1,u=!1,p="",{options:m={title:"WinRAR",min_width:250,min_height:220,width:250,height:220,resizable:!1,maximize_btn_disabled:!0,icon:"/images/xp/icons/RAR.png",id:n,exec_path:_}}=e;N.init({workerUrl:"/js/libarchive.js/dist/worker-bundle.js"}),ne(async()=>{if(a){let c=await J(a.id);const F=await N.open(c);t(5,i=await F.hasEncryptedData()),i||await y(c)}});async function h(){u=!0,fe.update(c=>c.filter(F=>F!=r)),r.$destroy()}async function d(){t(5,i=!1);let c=await J(a.id);await y(c,p)}async function y(c,F=null){const R=await N.open(c);F&&await R.usePassword(F);try{let S=await R.extractFiles();for(let z of Object.keys(S))await v(S[z],a.parent,z)}catch(S){console.log(S),t(4,o=S);return}h()}async function v(c,F,R){if(!u)if(c instanceof File){let S=new File([c],c.name,{type:pe(c.name)||c.type});await Q("file",X(R),he(R,X(R)),F,S)}else{let S=await Q("folder","",R,F,null);for(let z of Object.keys(c))await v(c[z],S,z)}}function V(){p=this.value,t(6,p)}const Y=c=>c.key=="Enter"&&d();function le(c){re[c?"unshift":"push"](()=>{s=c,t(0,s)})}return f.$$set=c=>{"id"in c&&t(8,n=c.id),"window"in c&&t(0,s=c.window),"self"in c&&t(9,r=c.self),"parentNode"in c&&t(10,l=c.parentNode),"fs_item"in c&&t(1,a=c.fs_item),"exec_path"in c&&t(11,_=c.exec_path),"options"in c&&t(2,m=c.options)},[s,a,m,h,o,i,p,d,n,r,l,_,V,Y,le]}class Le extends ee{constructor(e){super(),te(this,e,ke,Ee,se,{id:8,window:0,self:9,parentNode:10,fs_item:1,exec_path:11,options:2,destroy:3})}get id(){return this.$$.ctx[8]}set id(e){this.$$set({id:e}),D()}get window(){return this.$$.ctx[0]}set window(e){this.$$set({window:e}),D()}get self(){return this.$$.ctx[9]}set self(e){this.$$set({self:e}),D()}get parentNode(){return this.$$.ctx[10]}set parentNode(e){this.$$set({parentNode:e}),D()}get fs_item(){return this.$$.ctx[1]}set fs_item(e){this.$$set({fs_item:e}),D()}get exec_path(){return this.$$.ctx[11]}set exec_path(e){this.$$set({exec_path:e}),D()}get options(){return this.$$.ctx[2]}set options(e){this.$$set({options:e}),D()}get destroy(){return this.$$.ctx[3]}}export{Le as default};
