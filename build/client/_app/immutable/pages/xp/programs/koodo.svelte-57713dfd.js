import{_ as M}from"../../../chunks/preload-helper-c28b9807.js";import{S as U,i as Y,P as h,s as G,w as V,x as F,y as K,f as y,t as v,B as R,Y as I,l as b,a as X,m as x,n as k,c as Z,h as g,Q as $,p,b as A,J as P,K as ee,g as te,d as oe,W as N}from"../../../chunks/index-70a5fc52.js";import{W as ne}from"../../../chunks/Window-654de68f.js";import{h as se,z as ie,r as re,a as ae}from"../../../chunks/store-59feb90e.js";import{d as S,s as le,e as fe}from"../../../chunks/fs-f48425c2.js";import{D as ce}from"../../../chunks/DumbProgress-0b7ff768.js";import"../../../chunks/TitleBar-5f961d1e.js";import"../../../chunks/utils-1f7a3290.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-355ed6be.js";import"../../../chunks/index-f053a494.js";import"../../../chunks/finder-52261c48.js";import"../../../chunks/ProgressBar-f6d33f67.js";function q(i){let e,t,f;return t=new ce({props:{style:"width:150px;height:15px;"}}),{c(){e=b("div"),V(t.$$.fragment),this.h()},l(o){e=x(o,"DIV",{class:!0});var l=k(e);F(t.$$.fragment,l),l.forEach(g),this.h()},h(){p(e,"class","absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 text-slate-500 text-sm p-2 rounded font-mono")},m(o,l){A(o,e,l),K(t,e,null),f=!0},i(o){f||(y(t.$$.fragment,o),f=!0)},o(o){v(t.$$.fragment,o),f=!1},d(o){o&&g(e),R(t)}}}function de(i){let e,t,f,o,l,r,c,w,d,a=!i[4]&&q();return{c(){e=b("div"),t=b("div"),a&&a.c(),f=X(),o=b("iframe"),this.h()},l(s){e=x(s,"DIV",{slot:!0,class:!0});var _=k(e);t=x(_,"DIV",{class:!0});var u=k(t);a&&a.l(u),f=Z(u),o=x(u,"IFRAME",{src:!0,class:!0}),k(o).forEach(g),u.forEach(g),_.forEach(g),this.h()},h(){var s;$(o.src,l="/html/koodo/index.html")||p(o,"src",l),p(o,"class",r="w-full h-full "+(i[4]?"":"opacity-0")+" "+(((s=i[0])==null?void 0:s.z_index)==i[5]?"pointer-events-auto":"pointer-events-none")),p(t,"class","absolute inset-0 overflow-auto bg-slate-100 font-sans"),p(e,"slot","content"),p(e,"class","absolute inset-0 flex flex-col bg-slate-800")},m(s,_){A(s,e,_),P(e,t),a&&a.m(t,null),P(t,f),P(t,o),i[13](o),c=!0,w||(d=ee(o,"load",i[6]),w=!0)},p(s,_){var u;s[4]?a&&(te(),v(a,1,1,()=>{a=null}),oe()):a?_&16&&y(a,1):(a=q(),a.c(),y(a,1),a.m(t,f)),(!c||_&49&&r!==(r="w-full h-full "+(s[4]?"":"opacity-0")+" "+(((u=s[0])==null?void 0:u.z_index)==s[5]?"pointer-events-auto":"pointer-events-none")))&&p(o,"class",r)},i(s){c||(y(a),c=!0)},o(s){v(a),c=!1},d(s){s&&g(e),a&&a.d(),i[13](null),w=!1,d()}}}function _e(i){let e,t,f={options:i[2],on_click_close:i[1],on_focused:i[7],$$slots:{content:[de]},$$scope:{ctx:i}};return e=new ne({props:f}),i[14](e),{c(){V(e.$$.fragment)},l(o){F(e.$$.fragment,o)},m(o,l){K(e,o,l),t=!0},p(o,[l]){const r={};l&4&&(r.options=o[2]),l&524345&&(r.$$scope={dirty:l,ctx:o}),e.$set(r)},i(o){t||(y(e.$$.fragment,o),t=!0)},o(o){v(e.$$.fragment,o),t=!1},d(o){i[14](null),R(e,o)}}}async function ue({node_ref:i,filetypes_desc:e,filetypes:t}){return new Promise(async(f,o)=>{const l=(await M(()=>import("../../../chunks/OpenModal-56629948.js"),["_app/immutable/chunks/OpenModal-56629948.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-70a5fc52.js","_app/immutable/chunks/TitleBar-5f961d1e.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-59feb90e.js","_app/immutable/chunks/index-f053a494.js","_app/immutable/chunks/finder-52261c48.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/fs-f48425c2.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-e8580b92.js","_app/immutable/chunks/Previewable-7057b01c.js"])).default;let r=new l({target:i,props:{filetypes:t,filetypes_desc:e}});r.self=r,r.on_open=()=>{f(r.selected_items),r.destroy()}})}async function me({node_ref:i,filetypes:e,id:t,current_filetype:f}){return new Promise(async(o,l)=>{const r=(await M(()=>import("../../../chunks/SaveModal-25d78340.js"),["_app/immutable/chunks/SaveModal-25d78340.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-70a5fc52.js","_app/immutable/chunks/TitleBar-5f961d1e.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-59feb90e.js","_app/immutable/chunks/index-f053a494.js","_app/immutable/chunks/finder-52261c48.js","_app/immutable/chunks/fs-f48425c2.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-e8580b92.js","_app/immutable/chunks/Previewable-7057b01c.js"])).default;let c=new r({target:i,props:{filetypes:e,selected_filetype:f,id:t}});c.self=c,c.on_save=()=>{o({parent_id:c.parent_id,filename:c.filename,selected_filetype:c.selected_filetype}),c.destroy()}})}function he(i,e,t){let f,o;I(i,se,n=>t(15,f=n)),I(i,ie,n=>t(5,o=n));let{id:l}=e,{window:r}=e,{self:c}=e,{parentNode:w}=e,{fs_item:d}=e,{exec_path:a}=e,s,_=!1;async function u(){re.update(n=>n.filter(m=>m!=c)),c.$destroy()}let W={width:document.querySelector("#work-space").offsetWidth,height:document.querySelector("#work-space").offsetHeight},{options:z={title:"Koodo Reader",min_width:500,min_height:400,width:Math.min(W.width-20,(W.height-20)*1.6),height:Math.min(W.height-20),icon:"/images/xp/icons/Koodo.png",id:l,exec_path:a}}=e;async function O({filetypes_desc:n,filetypes:m}){let D=await ue({node_ref:r.node_ref,filetypes_desc:n,filetypes:m});return f[D[0]]}async function T(n){console.log(d);let m=[{name:"Document Format",ext:".epub"}],{parent_id:D,filename:E,selected_filetype:H}=await me({id:d==null?void 0:d.parent,node_ref:r.node_ref,filetypes:m}),J=new File([n],E),Q=le.generate();await fe(E,H.ext,J,D,Q)}async function j(){if(d){console.log(d);let n=await S(d.id);s.contentWindow.import_book(n)}t(3,s.contentWindow.on_import_click=async()=>{let n=await O({filetypes_desc:"Supported Formats",filetypes:[".epub",".mobi",".pdf",".docx",".html",".azw3",".txt",".fb2",".cbr",".cbz",".cbt",".md",".rtf",".xml",".xhtml",".htm"]}),m=await S(n.id);s.contentWindow.import_book(m)},s),t(3,s.contentWindow.open_url=n=>{ae.set({path:"./programs/internet_explorer.svelte",fs_item:{url:n}})},s),t(3,s.contentWindow.export_book=async n=>{await T(n)},s),t(4,_=!0),s.contentWindow.focus()}function L(){console.log("koodo:on_window_focused"),setTimeout(()=>{s&&s.contentWindow.focus()},500)}function B(n){N[n?"unshift":"push"](()=>{s=n,t(3,s)})}function C(n){N[n?"unshift":"push"](()=>{r=n,t(0,r)})}return i.$$set=n=>{"id"in n&&t(8,l=n.id),"window"in n&&t(0,r=n.window),"self"in n&&t(9,c=n.self),"parentNode"in n&&t(10,w=n.parentNode),"fs_item"in n&&t(11,d=n.fs_item),"exec_path"in n&&t(12,a=n.exec_path),"options"in n&&t(2,z=n.options)},[r,u,z,s,_,o,j,L,l,c,w,d,a,B,C]}class Ne extends U{constructor(e){super(),Y(this,e,he,_e,G,{id:8,window:0,self:9,parentNode:10,fs_item:11,exec_path:12,destroy:1,options:2})}get id(){return this.$$.ctx[8]}set id(e){this.$$set({id:e}),h()}get window(){return this.$$.ctx[0]}set window(e){this.$$set({window:e}),h()}get self(){return this.$$.ctx[9]}set self(e){this.$$set({self:e}),h()}get parentNode(){return this.$$.ctx[10]}set parentNode(e){this.$$set({parentNode:e}),h()}get fs_item(){return this.$$.ctx[11]}set fs_item(e){this.$$set({fs_item:e}),h()}get exec_path(){return this.$$.ctx[12]}set exec_path(e){this.$$set({exec_path:e}),h()}get destroy(){return this.$$.ctx[1]}get options(){return this.$$.ctx[2]}set options(e){this.$$set({options:e}),h()}}export{Ne as default};
