import{_ as G}from"../../../chunks/preload-helper-c28b9807.js";import{S as $,i as ee,R as p,s as te,w as L,x as O,y as V,f as w,t as x,B as A,Z as F,l as E,a as ne,m as P,n as k,c as ie,h as y,T as se,p as d,b as J,J as N,K as oe,g as ae,d as re,Y as S}from"../../../chunks/index-23b4510f.js";import{W as le}from"../../../chunks/Window-5b3973f4.js";import{h as fe,z as ce,r as me,a as ue}from"../../../chunks/store-21632576.js";import{n as z}from"../../../chunks/utils-1f7a3290.js";import{d as R,i as _e,s as de}from"../../../chunks/fs-93cd4a3b.js";import{s as pe}from"../../../chunks/index-5b24d155.js";import{D as he}from"../../../chunks/DumbProgress-04334b73.js";import"../../../chunks/TitleBar-a60117f4.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-355ed6be.js";import"../../../chunks/index-6533b345.js";import"../../../chunks/finder-bfb6260e.js";function q(o){let e,i,a;return i=new he({props:{style:"width:150px;height:15px;"}}),{c(){e=E("div"),L(i.$$.fragment),this.h()},l(s){e=P(s,"DIV",{class:!0});var l=k(e);O(i.$$.fragment,l),l.forEach(y),this.h()},h(){d(e,"class","absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 text-slate-500 text-sm p-2 rounded font-mono")},m(s,l){J(s,e,l),V(i,e,null),a=!0},i(s){a||(w(i.$$.fragment,s),a=!0)},o(s){x(i.$$.fragment,s),a=!1},d(s){s&&y(e),A(i)}}}function ge(o){let e,i,a,s,l,r,m,g,t=!o[4]&&q();return{c(){e=E("div"),t&&t.c(),i=ne(),a=E("iframe"),this.h()},l(c){e=P(c,"DIV",{slot:!0,class:!0});var u=k(e);t&&t.l(u),i=ie(u),a=P(u,"IFRAME",{src:!0,width:!0,height:!0,class:!0});var f=k(a);f.forEach(y),u.forEach(y),this.h()},h(){var c;se(a.src,s="/html/photon/app/index.html")||d(a,"src",s),d(a,"width","100%"),d(a,"height","100%"),d(a,"class",l="inset-0 absolute bg-black "+(o[4]?"":"opacity-0")+" "+(((c=o[0])==null?void 0:c.z_index)==o[5]?"pointer-events-auto":"pointer-events-none")),d(e,"slot","content"),d(e,"class","absolute inset-0 flex flex-col bg-black")},m(c,u){J(c,e,u),t&&t.m(e,null),N(e,i),N(e,a),o[12](a),r=!0,m||(g=oe(a,"load",o[6]),m=!0)},p(c,u){var f;c[4]?t&&(ae(),x(t,1,1,()=>{t=null}),re()):t?u&16&&w(t,1):(t=q(),t.c(),w(t,1),t.m(e,i)),(!r||u&49&&l!==(l="inset-0 absolute bg-black "+(c[4]?"":"opacity-0")+" "+(((f=c[0])==null?void 0:f.z_index)==c[5]?"pointer-events-auto":"pointer-events-none")))&&d(a,"class",l)},i(c){r||(w(t),r=!0)},o(c){x(t),r=!1},d(c){c&&y(e),t&&t.d(),o[12](null),m=!1,g()}}}function we(o){let e,i,a={options:o[2],on_click_close:o[1],$$slots:{content:[ge]},$$scope:{ctx:o}};return e=new le({props:a}),o[13](e),{c(){L(e.$$.fragment)},l(s){O(e.$$.fragment,s)},m(s,l){V(e,s,l),i=!0},p(s,[l]){const r={};l&4&&(r.options=s[2]),l&1048633&&(r.$$scope={dirty:l,ctx:s}),e.$set(r)},i(s){i||(w(e.$$.fragment,s),i=!0)},o(s){x(e.$$.fragment,s),i=!1},d(s){o[13](null),A(e,s)}}}async function ye({node_ref:o,filetypes_desc:e,filetypes:i}){return new Promise(async(a,s)=>{const l=(await G(()=>import("../../../chunks/OpenModal-db8f6c19.js"),["_app/immutable/chunks/OpenModal-db8f6c19.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-23b4510f.js","_app/immutable/chunks/TitleBar-a60117f4.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-21632576.js","_app/immutable/chunks/index-6533b345.js","_app/immutable/chunks/finder-bfb6260e.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-5b24d155.js","_app/immutable/chunks/fs-93cd4a3b.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-b8e82496.js","_app/immutable/chunks/Previewable-2a157018.js"])).default;let r=new l({target:o,props:{filetypes:i,filetypes_desc:e}});r.self=r,r.on_open=()=>{a(r.selected_items),r.destroy()}})}async function be({node_ref:o,filetypes:e,id:i,current_filetype:a}){return new Promise(async(s,l)=>{const r=(await G(()=>import("../../../chunks/SaveModal-a41fe8c5.js"),["_app/immutable/chunks/SaveModal-a41fe8c5.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-23b4510f.js","_app/immutable/chunks/TitleBar-a60117f4.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-21632576.js","_app/immutable/chunks/index-6533b345.js","_app/immutable/chunks/finder-bfb6260e.js","_app/immutable/chunks/index-5b24d155.js","_app/immutable/chunks/fs-93cd4a3b.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-b8e82496.js","_app/immutable/chunks/Previewable-2a157018.js"])).default;let m=new r({target:o,props:{filetypes:e,selected_filetype:a,id:i}});m.self=m,m.on_save=()=>{s({parent_id:m.parent_id,filename:m.filename,selected_filetype:m.selected_filetype}),m.destroy()}})}function M(o){return o==".jpg"||o==".jpeg"?"jpeg":"png"}function xe(o,e,i){let a,s;F(o,fe,n=>i(15,a=n)),F(o,ce,n=>i(5,s=n));let{id:l}=e,{window:r}=e,{self:m}=e,{parentNode:g}=e,{fs_item:t}=e,{exec_path:c}=e,u=[{name:"Portable Network Graphics",mime:"image/png",value:"image/png",ext:".png"},{name:"JPEG images",mime:"image/jpeg",value:"image/jpeg",ext:".jpg"},{name:"JPEG images",mime:"image/jpeg",value:"image/jpeg",ext:".jpeg"},{name:"Windows OS/2 Bitmap Graphics",mime:"image/bmp",value:"image/bmp",ext:".bmp"}];u=u.map(n=>(n.name=n.name+" ("+n.ext+")",n));let f,W=!1;async function T(){me.update(n=>n.filter(_=>_!=m)),m.$destroy()}let v={width:document.querySelector("#work-space").offsetWidth,height:document.querySelector("#work-space").offsetHeight},{options:j={title:t==null?"Photon Editor":t.name,min_width:500,min_height:400,width:Math.min(v.width-20,(v.height-20)*1.6),height:Math.min(v.height-20),icon:"/images/xp/icons/Photon.png",id:l,exec_path:c}}=e;async function U(){let n=await ye({node_ref:r.node_ref,filetypes_desc:"Image Files",filetypes:u.map(h=>h.ext)});i(7,t=a[n[0]]);let _=await R(n[0]);return console.log({fs_item:t}),_}async function B(){if(t!=null){let n=(t==null?void 0:t.ext)||".png",_=M(n);console.log({format:_});let h=z(f.contentWindow.imageEditor.toDataURL({format:_})),b=new File([h],t.name);_e(t.id,b),r.show_toast({message:"Changes Saved!"})}else D()}async function D(){console.log(t);let n=u.find(X=>X.ext==(t==null?void 0:t.ext));n==null&&(n=u[0]);let{parent_id:_,filename:h,selected_filetype:b}=await be({id:t==null?void 0:t.parent,node_ref:r.node_ref,filetypes:u,current_filetype:n}),Y=M(b.ext),Z=z(f.contentWindow.imageEditor.toDataURL({format:Y})),Q=new File([Z],h),I=pe.generate();await de(h,b.ext,Q,_,I),t==null&&i(7,t=a[I])}async function C(){if(f.contentWindow.setup_ui(),t!=null){let n=await R(t.id);f.contentWindow.imageEditor.loadImageFromFile(n,t.name)}i(3,f.contentWindow.about_func=()=>{ue.set({path:"./programs/internet_explorer.svelte",fs_item:{url:"https://ui.toast.com/tui-image-editor"}})},f),i(3,f.contentWindow.load_file_func=async()=>{let n=await U();f.contentWindow.imageEditor.loadImageFromFile(n,t.name)},f),i(3,f.contentWindow.save_file_func=async()=>{await B()},f),i(3,f.contentWindow.save_file_as_func=async()=>{await D()},f),i(4,W=!0)}function H(n){S[n?"unshift":"push"](()=>{f=n,i(3,f)})}function K(n){S[n?"unshift":"push"](()=>{r=n,i(0,r)})}return o.$$set=n=>{"id"in n&&i(8,l=n.id),"window"in n&&i(0,r=n.window),"self"in n&&i(9,m=n.self),"parentNode"in n&&i(10,g=n.parentNode),"fs_item"in n&&i(7,t=n.fs_item),"exec_path"in n&&i(11,c=n.exec_path),"options"in n&&i(2,j=n.options)},o.$$.update=()=>{o.$$.dirty&129&&t&&r&&r.update_title(t.name)},[r,T,j,f,W,s,C,t,l,m,g,c,H,K]}class Me extends ${constructor(e){super(),ee(this,e,xe,we,te,{id:8,window:0,self:9,parentNode:10,fs_item:7,exec_path:11,destroy:1,options:2})}get id(){return this.$$.ctx[8]}set id(e){this.$$set({id:e}),p()}get window(){return this.$$.ctx[0]}set window(e){this.$$set({window:e}),p()}get self(){return this.$$.ctx[9]}set self(e){this.$$set({self:e}),p()}get parentNode(){return this.$$.ctx[10]}set parentNode(e){this.$$set({parentNode:e}),p()}get fs_item(){return this.$$.ctx[7]}set fs_item(e){this.$$set({fs_item:e}),p()}get exec_path(){return this.$$.ctx[11]}set exec_path(e){this.$$set({exec_path:e}),p()}get destroy(){return this.$$.ctx[1]}get options(){return this.$$.ctx[2]}set options(e){this.$$set({options:e}),p()}}export{Me as default};
