import{_ as U}from"../../../chunks/preload-helper-c28b9807.js";import{S as oe,i as ae,R as g,s as re,w as j,x as B,y as C,K as H,f as P,t as z,B as J,Z as A,o as le,P as fe,l as E,a as ce,m as I,n as M,c as _e,h as b,p as w,T as S,q as V,b as K,J as W,g as ue,d as de,Y as F}from"../../../chunks/index-23b4510f.js";import{W as me}from"../../../chunks/Window-5b3973f4.js";import{h as he,z as we,r as pe}from"../../../chunks/store-21632576.js";import{l as ge}from"../../../chunks/utils-1f7a3290.js";import{d as L,s as ye,i as be}from"../../../chunks/fs-93cd4a3b.js";import{s as ve}from"../../../chunks/index-5b24d155.js";import{t as T}from"../../../chunks/finder-bfb6260e.js";import{D as ke}from"../../../chunks/DumbProgress-04334b73.js";import"../../../chunks/TitleBar-a60117f4.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-355ed6be.js";import"../../../chunks/index-6533b345.js";const{window:xe}=fe;function O(o){let t,s,l;return s=new ke({props:{style:"width:150px;height:15px;"}}),{c(){t=E("div"),j(s.$$.fragment),this.h()},l(n){t=I(n,"DIV",{class:!0});var c=M(t);B(s.$$.fragment,c),c.forEach(b),this.h()},h(){w(t,"class","absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 text-slate-500 text-sm p-2 rounded font-mono")},m(n,c){K(n,t,c),C(s,t,null),l=!0},i(n){l||(P(s.$$.fragment,n),l=!0)},o(n){z(s.$$.fragment,n),l=!1},d(n){n&&b(t),J(s)}}}function Pe(o){let t,s,l,n,c,a,i,m,d,r=!o[5]&&O();return{c(){t=E("div"),s=E("div"),r&&r.c(),l=ce(),n=E("iframe"),this.h()},l(f){t=I(f,"DIV",{slot:!0,class:!0});var u=M(t);s=I(u,"DIV",{class:!0});var h=M(s);r&&r.l(h),l=_e(h),n=I(h,"IFRAME",{class:!0,src:!0,allow:!0,frameborder:!0});var N=M(n);N.forEach(b),h.forEach(b),u.forEach(b),this.h()},h(){var f;w(n,"class",c="w-full h-full "+(o[5]?"":"hidden")+" "+(((f=o[0])==null?void 0:f.z_index)==o[6]?"pointer-events-auto":"pointer-events-none")),S(n.src,a=o[3])||w(n,"src",a),w(n,"allow","gamepad *;"),w(n,"frameborder","0"),n.allowFullscreen=!0,V(n,"background-color",o[7],!1),w(s,"class","absolute inset-0 overflow-auto bg-slate-100 font-sans"),V(s,"background-color",o[7],!1),w(t,"slot","content"),w(t,"class","absolute inset-0.5 top-0 flex flex-col bg-slate-800")},m(f,u){K(f,t,u),W(t,s),r&&r.m(s,null),W(s,l),W(s,n),o[16](n),i=!0,m||(d=H(n,"load",o[8]),m=!0)},p(f,u){var h;f[5]?r&&(ue(),z(r,1,1,()=>{r=null}),de()):r?u&32&&P(r,1):(r=O(),r.c(),P(r,1),r.m(s,l)),(!i||u&97&&c!==(c="w-full h-full "+(f[5]?"":"hidden")+" "+(((h=f[0])==null?void 0:h.z_index)==f[6]?"pointer-events-auto":"pointer-events-none")))&&w(n,"class",c),(!i||u&8&&!S(n.src,a=f[3]))&&w(n,"src",a)},i(f){i||(P(r),i=!0)},o(f){z(r),i=!1},d(f){f&&b(t),r&&r.d(),o[16](null),m=!1,d()}}}function De(o){let t,s,l,n,c={options:o[2],on_click_close:o[1],on_focused:o[9],$$slots:{content:[Pe]},$$scope:{ctx:o}};return t=new me({props:c}),o[17](t),{c(){j(t.$$.fragment)},l(a){B(t.$$.fragment,a)},m(a,i){C(t,a,i),s=!0,l||(n=H(xe,"message",o[10]),l=!0)},p(a,[i]){const m={};i&4&&(m.options=a[2]),i&67108985&&(m.$$scope={dirty:i,ctx:a}),t.$set(m)},i(a){s||(P(t.$$.fragment,a),s=!0)},o(a){z(t.$$.fragment,a),s=!1},d(a){o[17](null),J(t,a),l=!1,n()}}}async function Ee({node_ref:o,filetypes_desc:t,filetypes:s,multiple:l}){return new Promise(async(n,c)=>{const a=(await U(()=>import("../../../chunks/OpenModal-db8f6c19.js"),["_app/immutable/chunks/OpenModal-db8f6c19.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-23b4510f.js","_app/immutable/chunks/TitleBar-a60117f4.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-21632576.js","_app/immutable/chunks/index-6533b345.js","_app/immutable/chunks/finder-bfb6260e.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-5b24d155.js","_app/immutable/chunks/fs-93cd4a3b.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-b8e82496.js","_app/immutable/chunks/Previewable-2a157018.js"])).default;let i=new a({target:o,props:{filetypes:s,filetypes_desc:t,multiple:l}});i.self=i,i.on_open=()=>{n(i.selected_items),i.destroy()}})}async function Ie({node_ref:o,filetypes:t,id:s,current_filetype:l}){return new Promise(async(n,c)=>{const a=(await U(()=>import("../../../chunks/SaveModal-a41fe8c5.js"),["_app/immutable/chunks/SaveModal-a41fe8c5.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-23b4510f.js","_app/immutable/chunks/TitleBar-a60117f4.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-21632576.js","_app/immutable/chunks/index-6533b345.js","_app/immutable/chunks/finder-bfb6260e.js","_app/immutable/chunks/index-5b24d155.js","_app/immutable/chunks/fs-93cd4a3b.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-b8e82496.js","_app/immutable/chunks/Previewable-2a157018.js"])).default;let i=new a({target:o,props:{filetypes:t,selected_filetype:l,id:s}});i.self=i,i.on_save=()=>{n({parent_id:i.parent_id,filename:i.filename,selected_filetype:i.selected_filetype}),i.destroy()}})}function Me(o,t,s){let l,n;A(o,he,e=>s(18,l=e)),A(o,we,e=>s(6,n=e));let{id:c}=t,{window:a}=t,{self:i}=t,{parentNode:m}=t,{webapp:d}=t,r,{exec_path:f}=t,u,h=!1,N=(d==null?void 0:d.background)||"#ffffff";le(async()=>{s(3,r=se(d.url))});async function Y(){pe.update(e=>e.filter(_=>_!=i)),i.$destroy()}let R={width:document.querySelector("#work-space").offsetWidth,height:document.querySelector("#work-space").offsetHeight},{options:q={title:d.name,min_width:500,min_height:400,width:Math.min(R.width-20,(R.height-20)*1.6),height:Math.min(R.height-20),icon:d.icon,id:c,exec_path:f}}=t;async function Z(){s(5,h=!0)}function G(){setTimeout(()=>{u&&u.contentWindow.focus()},500)}async function Q(e="",_=[],v=!0){console.log(e),console.log(_);let k=await Ee({node_ref:a.node_ref,filetypes_desc:e,filetypes:_,multiple:v});console.log(k);let x=[];for(let p of k){let y=await L(p);x.push({id:p,win32_name:l[p].name,win32_path:T(p),file:y})}await D({type:"files_picked",files:x})}async function X(e,_){if(!(e instanceof File)||!Array.isArray(_))return;_=_.map(y=>(y.name=y.desc+` (${y.ext})`,y));let{parent_id:v,filename:k,selected_filetype:x}=await Ie({node_ref:a.node_ref,filetypes:_,current_filetype:_[0]}),p=ve.generate();e=new File([e],k,{type:x.mime}),await ye(k,x.ext,e,v,p),await D({type:"file_saved_as",fs_id:p})}async function $(e,_){await be(_,e),await D({type:"file_saved"})}async function ee(e){let _=l[e];if(e){let v=await L(e);await D({type:"file",file:{win32_path:T(e),win32_name:_.name,file:v}})}}async function te({data:e}){if((e==null?void 0:e.program_id)!=c)return;console.log(e);let{type:_}=e;_=="pick_files"?await Q(e.desc,e.exts,e.multiple):_=="save_file"?await $(e.file,e.fs_id):_=="save_file_as"?await X(e.file,e.types):_=="get_file"&&await ee(e.fs_id)}function se(e){return e=new URL(e),e.searchParams.set("program_id",c),e.searchParams.set("parent_origin",ge().location.origin),e.href}async function D(e){u.contentWindow.postMessage(e,new URL(r).origin)}function ne(e){F[e?"unshift":"push"](()=>{u=e,s(4,u)})}function ie(e){F[e?"unshift":"push"](()=>{a=e,s(0,a)})}return o.$$set=e=>{"id"in e&&s(11,c=e.id),"window"in e&&s(0,a=e.window),"self"in e&&s(12,i=e.self),"parentNode"in e&&s(13,m=e.parentNode),"webapp"in e&&s(14,d=e.webapp),"exec_path"in e&&s(15,f=e.exec_path),"options"in e&&s(2,q=e.options)},[a,Y,q,r,u,h,n,N,Z,G,te,c,i,m,d,f,ne,ie]}class Be extends oe{constructor(t){super(),ae(this,t,Me,De,re,{id:11,window:0,self:12,parentNode:13,webapp:14,exec_path:15,destroy:1,options:2})}get id(){return this.$$.ctx[11]}set id(t){this.$$set({id:t}),g()}get window(){return this.$$.ctx[0]}set window(t){this.$$set({window:t}),g()}get self(){return this.$$.ctx[12]}set self(t){this.$$set({self:t}),g()}get parentNode(){return this.$$.ctx[13]}set parentNode(t){this.$$set({parentNode:t}),g()}get webapp(){return this.$$.ctx[14]}set webapp(t){this.$$set({webapp:t}),g()}get exec_path(){return this.$$.ctx[15]}set exec_path(t){this.$$set({exec_path:t}),g()}get destroy(){return this.$$.ctx[1]}get options(){return this.$$.ctx[2]}set options(t){this.$$set({options:t}),g()}}export{Be as default};
