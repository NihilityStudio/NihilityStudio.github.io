import{_ as V}from"../../../chunks/preload-helper-c28b9807.js";import{S as X,i as $,R as w,s as ee,w as W,x as A,y as C,f as x,t as D,B as J,Z as q,l as j,a as te,m as E,n as F,c as ne,h as P,T as ie,p as g,b as M,J as H,K as se,g as ae,d as oe,Y as T}from"../../../chunks/index-23b4510f.js";import{W as le}from"../../../chunks/Window-5b3973f4.js";import{h as re,z as me,r as fe,a as z}from"../../../chunks/store-21632576.js";import{j as ce}from"../../../chunks/utils-1f7a3290.js";import{d as O,i as _e,s as ue}from"../../../chunks/fs-93cd4a3b.js";import{D as de}from"../../../chunks/DumbProgress-04334b73.js";import{s as pe}from"../../../chunks/index-5b24d155.js";import"../../../chunks/TitleBar-a60117f4.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-355ed6be.js";import"../../../chunks/index-6533b345.js";import"../../../chunks/finder-bfb6260e.js";function G(l){let e,i,a;return i=new de({props:{style:"width:150px;height:15px;"}}),{c(){e=j("div"),W(i.$$.fragment),this.h()},l(s){e=E(s,"DIV",{class:!0});var r=F(e);A(i.$$.fragment,r),r.forEach(P),this.h()},h(){g(e,"class","absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 text-slate-500 text-sm p-2 rounded font-mono")},m(s,r){M(s,e,r),C(i,e,null),a=!0},i(s){a||(x(i.$$.fragment,s),a=!0)},o(s){D(i.$$.fragment,s),a=!1},d(s){s&&P(e),J(i)}}}function ge(l){let e,i,a,s,r,o,c,b,n=!l[4]&&G();return{c(){e=j("div"),n&&n.c(),i=te(),a=j("iframe"),this.h()},l(m){e=E(m,"DIV",{slot:!0,class:!0});var f=F(e);n&&n.l(f),i=ne(f),a=E(f,"IFRAME",{src:!0,width:!0,height:!0,class:!0});var u=F(a);u.forEach(P),f.forEach(P),this.h()},h(){var m;ie(a.src,s="/html/jspaint/index.html")||g(a,"src",s),g(a,"width","100%"),g(a,"height","100%"),g(a,"class",r="inset-0 absolute bg-white "+(l[4]?"":"opacity-0")+" "+(((m=l[0])==null?void 0:m.z_index)==l[5]?"pointer-events-auto":"pointer-events-none")),g(e,"slot","content"),g(e,"class","absolute inset-1 top-0 flex flex-col bg-[rgb(192,192,192)] overflow-hidden")},m(m,f){M(m,e,f),n&&n.m(e,null),H(e,i),H(e,a),l[12](a),o=!0,c||(b=se(a,"load",l[6]),c=!0)},p(m,f){var u;m[4]?n&&(ae(),D(n,1,1,()=>{n=null}),oe()):n?f&16&&x(n,1):(n=G(),n.c(),x(n,1),n.m(e,i)),(!o||f&49&&r!==(r="inset-0 absolute bg-white "+(m[4]?"":"opacity-0")+" "+(((u=m[0])==null?void 0:u.z_index)==m[5]?"pointer-events-auto":"pointer-events-none")))&&g(a,"class",r)},i(m){o||(x(n),o=!0)},o(m){D(n),o=!1},d(m){m&&P(e),n&&n.d(),l[12](null),c=!1,b()}}}function he(l){let e,i,a={options:l[2],on_click_close:l[1],$$slots:{content:[ge]},$$scope:{ctx:l}};return e=new le({props:a}),l[13](e),{c(){W(e.$$.fragment)},l(s){A(e.$$.fragment,s)},m(s,r){C(e,s,r),i=!0},p(s,[r]){const o={};r&4&&(o.options=s[2]),r&524345&&(o.$$scope={dirty:r,ctx:s}),e.$set(o)},i(s){i||(x(e.$$.fragment,s),i=!0)},o(s){D(e.$$.fragment,s),i=!1},d(s){l[13](null),J(e,s)}}}async function R({node_ref:l,filetypes_desc:e,filetypes:i}){return new Promise(async(a,s)=>{const r=(await V(()=>import("../../../chunks/OpenModal-db8f6c19.js"),["_app/immutable/chunks/OpenModal-db8f6c19.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-23b4510f.js","_app/immutable/chunks/TitleBar-a60117f4.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-21632576.js","_app/immutable/chunks/index-6533b345.js","_app/immutable/chunks/finder-bfb6260e.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-5b24d155.js","_app/immutable/chunks/fs-93cd4a3b.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-b8e82496.js","_app/immutable/chunks/Previewable-2a157018.js"])).default;let o=new r({target:l,props:{filetypes:i,filetypes_desc:e}});o.self=o,o.on_open=()=>{a(o.selected_items),o.destroy()}})}async function we({node_ref:l,filetypes:e,id:i,current_filetype:a}){return new Promise(async(s,r)=>{const o=(await V(()=>import("../../../chunks/SaveModal-a41fe8c5.js"),["_app/immutable/chunks/SaveModal-a41fe8c5.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-23b4510f.js","_app/immutable/chunks/TitleBar-a60117f4.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/store-21632576.js","_app/immutable/chunks/index-6533b345.js","_app/immutable/chunks/finder-bfb6260e.js","_app/immutable/chunks/index-5b24d155.js","_app/immutable/chunks/fs-93cd4a3b.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/Button-b8e82496.js","_app/immutable/chunks/Previewable-2a157018.js"])).default;let c=new o({target:l,props:{filetypes:e,selected_filetype:a,id:i}});c.self=c,c.on_save=()=>{s({parent_id:c.parent_id,filename:c.filename,selected_filetype:c.selected_filetype}),c.destroy()}})}function ye(l,e,i){let a,s;q(l,re,t=>i(15,a=t)),q(l,me,t=>i(5,s=t));let{id:r}=e,{window:o}=e,{self:c}=e,{parentNode:b}=e,{fs_item:n}=e,{exec_path:m}=e,f=[{name:"Portable Network Graphics",mime:"image/png",value:"image/png",ext:".png"},{name:"JPEG images",mime:"image/jpeg",value:"image/jpeg",ext:".jpg"},{name:"JPEG images",mime:"image/jpeg",value:"image/jpeg",ext:".jpeg"},{name:"Windows OS/2 Bitmap Graphics",mime:"image/bmp",value:"image/bmp",ext:".bmp"}];f=f.map(t=>(t.name=t.name+" ("+t.ext+")",t));let u,I=!1;async function U(){fe.update(t=>t.filter(p=>p!=c)),c.$destroy()}let{options:S={title:n==null?"Paint":n.name,min_width:500,min_height:400,width:700,height:500,icon:"/images/xp/icons/Paint.png",id:r,exec_path:m}}=e;async function L(){let t=await R({node_ref:o.node_ref,filetypes_desc:"Image Files",filetypes:f.map(_=>_.ext)}),p=a[t[0]];z.set({path:"./programs/paint.svelte",fs_item:p})}async function K(){let t=await R({node_ref:o.node_ref,filetypes_desc:"Image Files",filetypes:f.map(_=>_.ext)});i(7,n=a[t[0]]);let p=await O(t[0]);return console.log({fs_item:n}),p}async function N(){console.log(n);let t=f.find(h=>h.ext==(n==null?void 0:n.ext));t==null&&(t=f[0]);let{parent_id:p,filename:_,selected_filetype:d}=await we({id:n==null?void 0:n.parent,node_ref:o.node_ref,filetypes:f,current_filetype:t});console.log(d),u.contentDocument.querySelector(".main-canvas").toBlob(async h=>{let k=new File([h],_),v=pe.generate();await ue(_,d.ext,k,p,v),n==null&&i(7,n=a[v])},d.mime)}async function Y(){i(4,I=!0);var t=u.contentWindow;if(t.set_theme("classic.css"),t.open_in_new_window=L,t.open_empty_window=()=>{z.set({path:"./programs/paint.svelte"})},n!=null){console.log({fs_item:n});let _=await O(n.id);console.log(_),t.open_from_file(_)}p(()=>t.systemHooks,500,()=>{t.systemHooks.showSaveFileDialog=async({formats:_,defaultFileName:d,defaultPath:y,defaultFileFormatID:h,getBlob:k,savedCallbackUnreliable:v,dialogTitle:B})=>{await N()},t.systemHooks.showOpenFileDialog=async({formats:_})=>{let d=await K();return{file:d,file_handle:d}},t.systemHooks.writeBlobToHandle=async(_,d)=>{if(console.log("writeBlobtoHandle"),n!=null){let y=(n==null?void 0:n.ext)||".png",h=ce(y,"image/png");console.log({mimetype:h}),u.contentDocument.querySelector(".main-canvas").toBlob(v=>{let B=new File([v],n.name);_e(n.id,B),o.show_toast({message:"Changes Saved!"})},h)}else N()},u.contentDocument.querySelector(".menus").style.pointerEvents="auto"});function p(_,d,y){_()?y():setTimeout(p,d,_,d,y)}}function Z(t){T[t?"unshift":"push"](()=>{u=t,i(3,u)})}function Q(t){T[t?"unshift":"push"](()=>{o=t,i(0,o)})}return l.$$set=t=>{"id"in t&&i(8,r=t.id),"window"in t&&i(0,o=t.window),"self"in t&&i(9,c=t.self),"parentNode"in t&&i(10,b=t.parentNode),"fs_item"in t&&i(7,n=t.fs_item),"exec_path"in t&&i(11,m=t.exec_path),"options"in t&&i(2,S=t.options)},l.$$.update=()=>{l.$$.dirty&129&&n&&o&&o.update_title(n.name)},[o,U,S,u,I,s,Y,n,r,c,b,m,Z,Q]}class He extends X{constructor(e){super(),$(this,e,ye,he,ee,{id:8,window:0,self:9,parentNode:10,fs_item:7,exec_path:11,destroy:1,options:2})}get id(){return this.$$.ctx[8]}set id(e){this.$$set({id:e}),w()}get window(){return this.$$.ctx[0]}set window(e){this.$$set({window:e}),w()}get self(){return this.$$.ctx[9]}set self(e){this.$$set({self:e}),w()}get parentNode(){return this.$$.ctx[10]}set parentNode(e){this.$$set({parentNode:e}),w()}get fs_item(){return this.$$.ctx[7]}set fs_item(e){this.$$set({fs_item:e}),w()}get exec_path(){return this.$$.ctx[11]}set exec_path(e){this.$$set({exec_path:e}),w()}get destroy(){return this.$$.ctx[1]}get options(){return this.$$.ctx[2]}set options(e){this.$$set({options:e}),w()}}export{He as default};
