import{S as de,i as pe,s as _e,l as q,a as J,r as me,m as R,n as A,h as v,c as O,u as he,p as k,q as E,b as Z,J as x,K as w,E as Q,_ as $,Y as T,P as De,w as ge,x as be,a5 as Ee,y as ye,Z as Ie,a1 as qe,a6 as Re,d as ke,f as X,t as Y,B as ve,a7 as j,o as Ae,g as we,v as Be,a8 as Me,W as ze,D as Pe}from"../../chunks/index-70a5fc52.js";import{h as F,i as ne,a as L,c as W,g as ae,f as Ve,e as Ke,j as Ce,k as re,l as oe,n as Fe}from"../../chunks/store-59feb90e.js";import{u as Le,i as je,f as Te,g as Je,h as Oe}from"../../chunks/utils-1f7a3290.js";import{c as We,a as Xe,p as Ye}from"../../chunks/fs-f48425c2.js";import"../../chunks/lodash-b0811ec1.js";import{D as Ze,p as Ge}from"../../chunks/dir_parser-92703b79.js";import{P as He}from"../../chunks/Previewable-7057b01c.js";import"../../chunks/index-f053a494.js";import"../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../chunks/index-355ed6be.js";import"../../chunks/finder-52261c48.js";function Ne(i){let e,t,s,l,o,p,u,m;return{c(){e=q("div"),t=q("div"),s=J(),l=q("p"),o=me("Recycle Bin"),this.h()},l(r){e=R(r,"DIV",{class:!0,style:!0});var d=A(e);t=R(d,"DIV",{class:!0}),A(t).forEach(v),s=O(d),l=R(d,"P",{class:!0,style:!0});var h=A(l);o=he(h,"Recycle Bin"),h.forEach(v),d.forEach(v),this.h()},h(){k(t,"class","w-[40px] h-[40px] bg-contain"),E(t,"background-image",i[2],!1),k(l,"class","text-center text-[11px] font-MSSS text-white"),E(l,"text-shadow","1px 1px 2px black"),k(e,"class",p="flex flex-col items-center absolute bottom-2 right-2 "+i[1]),k(e,"style",i[0])},m(r,d){Z(r,e,d),x(e,t),x(e,s),x(e,l),x(l,o),u||(m=[w(e,"dblclick",i[3]),w(e,"contextmenu",i[4])],u=!0)},p(r,[d]){d&4&&E(t,"background-image",r[2],!1),d&2&&p!==(p="flex flex-col items-center absolute bottom-2 right-2 "+r[1])&&k(e,"class",p),d&1&&k(e,"style",r[0])},i:Q,o:Q,d(r){r&&v(e),u=!1,$(m)}}}function Qe(i,e,t){let s,l;T(i,F,r=>t(5,l=r));let{style:o}=e,{classes:p}=e;function u(){let r=l[ne];L.set({path:"./programs/my_computer.svelte",fs_item:r})}function m(r){W.set(null),W.set({x:r.x,y:r.y,type:"RecycleBin",originator:null})}return i.$$set=r=>{"style"in r&&t(0,o=r.style),"classes"in r&&t(1,p=r.classes)},i.$$.update=()=>{var r,d;i.$$.dirty&32&&t(2,s=((r=l[ne])==null?void 0:r.children.length)>0||((d=l[ne])==null?void 0:d.children.length)>0?"url(/images/xp/icons/RecycleBinfull.png)":"url(/images/xp/icons/RecycleBinempty.png)")},[o,p,s,u,m,l]}class Ue extends de{constructor(e){super(),pe(this,e,Qe,Ne,_e,{style:0,classes:1})}}function ce(i,e,t){const s=i.slice();return s[28]=e[t],s[30]=t,s}function $e(i){let e,t;return{c(){e=q("div"),this.h()},l(s){e=R(s,"DIV",{class:!0});var l=A(e);l.forEach(v),this.h()},h(){k(e,"class",t="w-[40px] h-[40px] shrink-0 bg-contain bg-no-repeat bg-center "+(i[5].includes(i[28].id)&&i[6]=="cut"?"opacity-70":"")+" "+(i[28].type=="folder"?"bg-[url(/images/xp/icons/FolderClosed.png)]":"bg-[url(/images/xp/icons/Default.png)]")),E(e,"background-image",i[15](i[28]),!1)},m(s,l){Z(s,e,l)},p(s,l){l&104&&t!==(t="w-[40px] h-[40px] shrink-0 bg-contain bg-no-repeat bg-center "+(s[5].includes(s[28].id)&&s[6]=="cut"?"opacity-70":"")+" "+(s[28].type=="folder"?"bg-[url(/images/xp/icons/FolderClosed.png)]":"bg-[url(/images/xp/icons/Default.png)]"))&&k(e,"class",t),l&8&&E(e,"background-image",s[15](s[28]),!1)},i:Q,o:Q,d(s){s&&v(e)}}}function et(i){let e,t;return e=new He({props:{size:40,default_icon:i[15](i[28]),fs_id:i[28].id}}),{c(){ge(e.$$.fragment)},l(s){be(e.$$.fragment,s)},m(s,l){ye(e,s,l),t=!0},p(s,l){const o={};l&8&&(o.default_icon=s[15](s[28])),l&8&&(o.fs_id=s[28].id),e.$set(o)},i(s){t||(X(e.$$.fragment,s),t=!0)},o(s){Y(e.$$.fragment,s),t=!1},d(s){ve(e,s)}}}function ue(i){let e,t,s,l;function o(...u){return i[17](i[28],...u)}function p(...u){return i[18](i[28],...u)}return{c(){e=q("textarea"),this.h()},l(u){e=R(u,"TEXTAREA",{class:!0}),A(e).forEach(v),this.h()},h(){e.autofocus=!0,k(e,"class","absolute max-h-[40px] left-0 top-[40px] right-0 bottom-0 overflow-hidden outline-none border-1 border-slate-900 text-[11px] font-MSSS z-50 resize-none"),e.value=t=i[28].name},m(u,m){Z(u,e,m),e.focus(),s||(l=[w(e,"keydown",o),w(e,"blur",p)],s=!0)},p(u,m){i=u,m&8&&t!==(t=i[28].name)&&(e.value=t)},d(u){u&&v(e),s=!1,$(l)}}}function fe(i,e){let t,s,l,o,p,u,m=(e[28].executable?e[28].basename:e[28].name)+"",r,d,h,f=e[4].includes(e[28].id)&&e[0],c,y,B=`${U}px`,ee=`${U}px`,I,z,G;const K=[et,$e],S=[];function H(b,_){return _&8&&(s=null),s==null&&(s=!!Fe.includes(b[28].ext)),s?0:1}l=H(e,-1),o=S[l]=K[l](e);let g=f&&ue(e);function te(){return e[19](e[28])}function le(...b){return e[20](e[28],...b)}return{key:i,first:null,c(){t=q("div"),o.c(),p=J(),u=q("p"),r=me(m),h=J(),g&&g.c(),c=J(),this.h()},l(b){t=R(b,"DIV",{"fs-id":!0,class:!0});var _=A(t);o.l(_),p=O(_),u=R(_,"P",{class:!0,style:!0});var M=A(u);r=he(M,m),M.forEach(v),h=O(_),g&&g.l(_),c=O(_),_.forEach(v),this.h()},h(){var b;k(u,"class",d="px-1 mx-0.5 text-[11px] break-words line-clamp-2 text-ellipsis leading-tight text-center text-white "+(((b=e[4])==null?void 0:b.includes(e[28].id))&&e[1]?"bg-blue-600 text-slate-50":"")),E(u,"text-shadow","1px 1px 2px black"),k(t,"fs-id",y=e[28].id),k(t,"class","relative fs-item w-[150px] flex-shrink-0 flex-grow-0 overflow-hidden m-2 inline-flex flex-col items-center font-MSSS"),E(t,"transform",e[28].desktop_css_transform,!1),E(t,"width",B,!1),E(t,"height",ee,!1),this.first=t},m(b,_){Z(b,t,_),S[l].m(t,null),x(t,p),x(t,u),x(u,r),x(t,h),g&&g.m(t,null),x(t,c),I=!0,z||(G=[w(t,"dblclick",te),w(t,"contextmenu",le)],z=!0)},p(b,_){var N;e=b;let M=l;l=H(e,_),l===M?S[l].p(e,_):(we(),Y(S[M],1,1,()=>{S[M]=null}),ke(),o=S[l],o?o.p(e,_):(o=S[l]=K[l](e),o.c()),X(o,1),o.m(t,p)),(!I||_&8)&&m!==(m=(e[28].executable?e[28].basename:e[28].name)+"")&&Be(r,m),(!I||_&26&&d!==(d="px-1 mx-0.5 text-[11px] break-words line-clamp-2 text-ellipsis leading-tight text-center text-white "+(((N=e[4])==null?void 0:N.includes(e[28].id))&&e[1]?"bg-blue-600 text-slate-50":"")))&&k(u,"class",d),_&25&&(f=e[4].includes(e[28].id)&&e[0]),f?g?g.p(e,_):(g=ue(e),g.c(),g.m(t,c)):g&&(g.d(1),g=null),(!I||_&8&&y!==(y=e[28].id))&&k(t,"fs-id",y),_&8&&E(t,"transform",e[28].desktop_css_transform,!1)},i(b){I||(X(o),I=!0)},o(b){Y(o),I=!1},d(b){b&&v(t),S[l].d(),g&&g.d(),z=!1,$(G)}}}function tt(i){let e,t,s=[],l=new Map,o,p,u,m,r,d=i[3];const h=f=>f[28].id;for(let f=0;f<d.length;f+=1){let c=ce(i,d,f),y=h(c);l.set(y,s[f]=fe(y,c))}return p=new Ue({props:{style:"width: "+U+"px;height: "+U+"px;"}}),{c(){e=q("div"),t=q("div");for(let f=0;f<s.length;f+=1)s[f].c();o=J(),ge(p.$$.fragment),this.h()},l(f){e=R(f,"DIV",{class:!0});var c=A(e);t=R(c,"DIV",{class:!0});var y=A(t);for(let B=0;B<s.length;B+=1)s[B].l(y);y.forEach(v),o=O(c),be(p.$$.fragment,c),c.forEach(v),this.h()},h(){k(t,"class","top-0 left-0 bottom-0 absolute flex flex-col flex-wrap"),Ee(t,"hidden",i[8]==null),k(e,"class","absolute z-0 inset-0 overflow-hidden bg-transparent")},m(f,c){Z(f,e,c),x(e,t);for(let y=0;y<s.length;y+=1)s[y].m(t,null);x(e,o),ye(p,e,null),i[23](e),u=!0,m||(r=[w(window,"keydown",i[13]),w(e,"drop",i[14]),w(e,"dragover",lt),w(e,"click",i[21]),Ie(i[7].call(null,e)),w(e,"click_outside",i[22]),w(e,"contextmenu",qe(i[10]))],m=!0)},p(f,[c]){c&39547&&(d=f[3],we(),s=Re(s,c,h,1,f,d,l,t,Me,fe,null,ce),ke())},i(f){if(!u){for(let c=0;c<d.length;c+=1)X(s[c]);X(p.$$.fragment,f),u=!0}},o(f){for(let c=0;c<s.length;c+=1)Y(s[c]);Y(p.$$.fragment,f),u=!1},d(f){f&&v(e);for(let c=0;c<s.length;c+=1)s[c].d();ve(p),i[23](null),m=!1,$(r)}}}let U=80;function lt(i){i.preventDefault()}function st(i,e,t){let s,l,o,p,u;T(i,F,n=>t(16,l=n)),T(i,ae,n=>t(4,o=n)),T(i,Ve,n=>t(5,p=n)),T(i,Ke,n=>t(6,u=n));const{click_outside:m}=Le;let r=Ce,d=!0,h,{renaming:f=!1}=e;const c=new Ze({customStyles:!1,draggability:!0});c.subscribe("callback",n=>{for(let a of n.items){let D=a.getAttribute("fs-id");D!=null&&l[D]!=null&&(je(a.style.transform)||j(F,l[D].desktop_css_transform=a.style.transform,l))}j(ae,o=n.items.map(a=>a.getAttribute("fs-id")).filter(a=>l[a]!=null),o),console.log(o.map(a=>l[a]))});const y=new MutationObserver(n=>{c.setSettings({selectables:h?h.querySelectorAll(".fs-item"):[]})});Ae(async()=>{c.setSettings({selectables:h.querySelectorAll(".fs-item"),area:h}),y.observe(h,{attributes:!1,childList:!0,characterData:!1,subtree:!0})});function B(n,a){let D=o.includes(a.id),P=h.querySelector(`.fs-item[fs-id="${a.id}"]`);!D&&P&&P.classList.contains("fs-item")&&(n.metaKey||n.ctrlKey?c.addSelection([P],!0):c.setSelection([P],!0)),W.set(null);let C={item:a};C.open=V=>{z(V)},C.rename=()=>{G()},W.set({x:n.x,y:n.y,type:"FSItem",originator:C})}function ee(n){let a={id:r};W.set({x:n.x,y:n.y,type:"Desktop",originator:a})}function I(){console.log("clear_selection"),c.clearSelection(!0)}function z(n){t(1,d=!1),I();let a=l[n];a.type=="file"?a.executable?L.set({path:a.url,webapp:a.webapp}):re[a.ext]!=null?L.set({path:re[a.ext][0].path,fs_item:a}):L.set({path:"./programs/notepad.svelte",fs_item:a}):L.set({path:"./programs/my_computer.svelte",fs_item:a})}function G(){t(0,f=!0),Pe().then(()=>{let n=o[0],a=document.querySelector(`div[fs-id="${n}"] textarea`),D=l[n].basename.length;a!=null&&a.setSelectionRange(0,D)})}function K(n,a){let D=Te(n.target.value),P=Je(D),C=Oe(D,P),V=C;if(a.ext=P.toLowerCase(),V.trim()==""){t(0,f=!1);return}let Se=[...l[a.parent].children.filter(se=>se!=a.id).map(se=>l[se].name)],ie=2;for(;Se.includes(V+a.ext);)V=C+" "+ie,ie++;j(F,l[a.id].basename=V,l),j(F,l[a.id].ext=a.ext,l),j(F,l[a.id].name=V+a.ext,l),t(0,f=!1)}function S(n){if(!!d&&!f&&(console.log("keyevent in desktop_folder"),!!(n.ctrlKey||n.metaKey))){if(n.key=="c")We();else if(n.key=="x")Xe();else if(n.key=="v")Ye(r);else if(n.key=="a"){let a=h.querySelectorAll(".fs-item");c.setSelection(a,!0)}}}async function H(n){n.preventDefault();let a=await Ge(n);L.set({path:"./programs/copier.svelte",copying_obj:a,target_folder_id:r})}function g(n){return n.icon!=null?`url(${n.icon})`:oe[n.ext]!=null?`url(/images/xp/icons/${oe[n.ext]})`:null}const te=(n,a)=>a.key=="Enter"&&K(a,n),le=(n,a)=>K(a,n),b=n=>z(n.id),_=(n,a)=>B(a,n),M=()=>t(1,d=!0),N=()=>{t(1,d=!1)};function xe(n){ze[n?"unshift":"push"](()=>{h=n,t(2,h)})}return i.$$set=n=>{"renaming"in n&&t(0,f=n.renaming)},i.$$.update=()=>{i.$$.dirty&65536&&t(3,s=l[r]==null?[]:l[r].children.map(n=>l[n]).filter(n=>n!=null))},[f,d,h,s,o,p,u,m,r,B,ee,z,K,S,H,g,l,te,le,b,_,M,N,xe]}class mt extends de{constructor(e){super(),pe(this,e,st,tt,_e,{renaming:0})}get renaming(){return this.$$.ctx[0]}set renaming(e){this.$$set({renaming:e}),De()}}export{mt as default};
